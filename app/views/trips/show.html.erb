<div class= "show_page" style="background-image: url('https://live.staticflickr.com/2162/1534505052_f571970f2c_b.jpg')">

  <div class="trip_name">
  <h1><%= @trip.name %></h1>
  </div>
  <div>
    <%= link_to edit_trip_path do %>
      <i class="fa-solid fa-pen-to-square fa-lg"></i>
    <% end %>
  </div>
  <br>
  <br>
  <div class="tripper_share">
    <div class="trippers">
      <% @trippers.first(3).each do |user| %>
        <img class="rounded-circle" width="30px" height="30px" src="<%= user.photo.attached? ? image_path("user_seeds/#{user.photo.filename}") : image_path('avatar.png') %>" />
      <% end %>
      <% if @trippers.count > 3 %>
        <span class="rounded-pill border border-success p-2">+ <%= pluralize(@trippers.count - 3, "tripper") %></span>
      <% end %>
    </div>

    <div>
    <i class="fa-solid fa-arrow-up-from-bracket"></i>
    </div>
  </div>

  <div class="card_trip_show">
    <div class="trip_viewall">

      <div class="secondary-pill-button">
        <%= link_to "ADD EVENT",  new_trip_event_path(@trip) %>
      </div>

      <h3 id="expand-all-button">VIEW ALL</h3>
    </div>
    <% if @trip.events.any? %>
      <div>
        <% @grouped_events = @chron_events.group_by { |e| e.start_date.to_date } %>

          <% @grouped_events.each do |day, events| %>

            <div class="accordion">
              <div class="flex-container">
                <h2><%= day.strftime("%b %d") %></h2>
                  <div class="event-button">
                    <p><%= pluralize(events.count, "event").upcase %></p>
                  </div>
                  <i class="fa-solid fa-chevron-down" style="color: #ffffff;"></i>
              </div>

                <div class="panel">
                  <% events.each do |event| %>
                  <%= event.other? ?  "CUSTOM EVENT" : event.event_type.upcase %> <br>
                  <% case event.event_type
                    when "journey", "flight", "train", "bus", "boat" %>
                      <%# MISSING: FLIGHT NUMBER, TRAIN NUMBER, ETC. %>
                      <%# MISSING: USE GEOCDER TO DISPLAY SHORTER START LOCATIONS (CITY NAME, AIRPORT NAME, ETC.) %>
                      Departing: <%= event.format_start_time %> <%= event.format_start_date %>
                      ------
                      Arriving: <%= event.format_end_time %> <%= event.format_end_date %>
                      <br>
                      From: <%= event.start_location %>
                      ------
                      To: <%= event.end_location %>
                      <br>
                      Duration: <%= event.format_duration_h_min %>
                      <br>
                      <br>

                    <% when "rental" %>
                      <%# MISSING: THIS NEEDS TO BE BROKEN DOWN INTO TWO EVENTS: Pick up vs Drop off %>
                      Pick up:
                      <%= event.start_location %> at
                      <%= event.format_start_time %> on
                      <%= event.start_date.strftime("%b %d") %>
                      <br>
                      Drop off:
                      <%= event.end_location %> at
                      <%= event.format_end_time %> on
                      <%= event.format_end_date %>
                      <br>
                      Renting for <%= pluralize(event.format_duration_d, "day") %>
                      <br>
                      <br>
                    <% when "stay" %>
                      <div class="other-event-card-container">
                        <div>
                          <div class="event-infomations" style="margin-bottom: 21px">
                            <h2><%= "#{event.provider} in " if event.provider %><%= event.start_location %><h2>
                          </div>
                          <div class="event-infomations">
                            <div class="horizontal-display">
                              <svg style="margin-right: 9px" width="14" height="15" viewBox="0 0 14 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path d="M0 13.5938C0 14.3701 0.671875 15 1.5 15H12.5C13.3281 15 14 14.3701 14 13.5938V5.625H0V13.5938ZM10 7.85156C10 7.6582 10.1688 7.5 10.375 7.5H11.625C11.8312 7.5 12 7.6582 12 7.85156V9.02344C12 9.2168 11.8312 9.375 11.625 9.375H10.375C10.1688 9.375 10 9.2168 10 9.02344V7.85156ZM10 11.6016C10 11.4082 10.1688 11.25 10.375 11.25H11.625C11.8312 11.25 12 11.4082 12 11.6016V12.7734C12 12.9668 11.8312 13.125 11.625 13.125H10.375C10.1688 13.125 10 12.9668 10 12.7734V11.6016ZM6 7.85156C6 7.6582 6.16875 7.5 6.375 7.5H7.625C7.83125 7.5 8 7.6582 8 7.85156V9.02344C8 9.2168 7.83125 9.375 7.625 9.375H6.375C6.16875 9.375 6 9.2168 6 9.02344V7.85156ZM6 11.6016C6 11.4082 6.16875 11.25 6.375 11.25H7.625C7.83125 11.25 8 11.4082 8 11.6016V12.7734C8 12.9668 7.83125 13.125 7.625 13.125H6.375C6.16875 13.125 6 12.9668 6 12.7734V11.6016ZM2 7.85156C2 7.6582 2.16875 7.5 2.375 7.5H3.625C3.83125 7.5 4 7.6582 4 7.85156V9.02344C4 9.2168 3.83125 9.375 3.625 9.375H2.375C2.16875 9.375 2 9.2168 2 9.02344V7.85156ZM2 11.6016C2 11.4082 2.16875 11.25 2.375 11.25H3.625C3.83125 11.25 4 11.4082 4 11.6016V12.7734C4 12.9668 3.83125 13.125 3.625 13.125H2.375C2.16875 13.125 2 12.9668 2 12.7734V11.6016ZM12.5 1.875H11V0.46875C11 0.210937 10.775 0 10.5 0H9.5C9.225 0 9 0.210937 9 0.46875V1.875H5V0.46875C5 0.210937 4.775 0 4.5 0H3.5C3.225 0 3 0.210937 3 0.46875V1.875H1.5C0.671875 1.875 0 2.50488 0 3.28125V4.6875H14V3.28125C14 2.50488 13.3281 1.875 12.5 1.875Z" fill="#7F7EFF"/>
                              </svg>
                              <p><%= event.start_date.strftime("%b %d") %>, <%= event.end_date.strftime("%b %d") %> (<%= pluralize(event.format_duration_d, "night") %>)</p>
                            </div>
                              <div class="horizontal-display">
                                <svg style="margin-right: 9px" width="15" height="25" viewBox="0 0 15 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path id="Vector" d="M5.46875 15.4756V23.1265L6.54395 24.7388C6.77588 25.0864 7.28711 25.0864 7.51904 24.7388L8.59375 23.1265V15.4756C8.08643 15.5693 7.56543 15.625 7.03125 15.625C6.49707 15.625 5.97607 15.5693 5.46875 15.4756ZM7.03125 0C3.14795 0 0 3.14795 0 7.03125C0 10.9146 3.14795 14.0625 7.03125 14.0625C10.9146 14.0625 14.0625 10.9146 14.0625 7.03125C14.0625 3.14795 10.9146 0 7.03125 0ZM7.03125 3.71094C5.2002 3.71094 3.71094 5.2002 3.71094 7.03125C3.71094 7.35449 3.44824 7.61719 3.125 7.61719C2.80176 7.61719 2.53906 7.35449 2.53906 7.03125C2.53906 4.5542 4.55469 2.53906 7.03125 2.53906C7.35449 2.53906 7.61719 2.80176 7.61719 3.125C7.61719 3.44824 7.35449 3.71094 7.03125 3.71094Z" fill="#7F7EFF"/>
                                </svg>
                                <p><%= event.start_location %></p>
                            </div>
                          </div>
                        </div>
                      </div>
                    <% when "restaurant", "visit", "show" %>
                      <%= event.name %>
                      <% if event.event_type == "show" %>
                        at <%= event.provider %>
                        <br>
                        Show starts at <%= event.format_start_time %>
                      <% else %>
                        at <%= event.format_start_time %>
                      <% end %>
                      <br>
                      Address: <%= event.start_location %>
                      <br>

                    <% else %>
                    <%= event.name %>
                    <br>
                    Starts at <%= event.format_start_time %>
                    Location: <%= event.start_location %>
                    <br>
                    Ends at <%= event.format_end_time %>
                    <% if event.end_location != event.start_location %>
                      Location: <%= event.end_location %>
                    <% end %>
                    <br>
                    <br>
                  <% end %>
                  <% end %>
                </div>
            </div>
          <% end %>
        <% else %>
      <p>Mmh, it’s pretty quiet there... Tap on “ADD EVENT" to start</p>
    <% end %>
  </div>
</div>
